<div class="padding-l-1 padding-r-1 padding-t-1 text-center margin-b-7">
  <p class="ft-2p5 ft-65 margin-b-1 margin-t-1">注册宏财账号</p>
  <form autocomplete="off" class="register-form margin-0 padding-b-2 padding-t-1 ft-grey" name="registerForm" autocomplete="on"  id="registerForm">
    <div class="to-register">
      <!-- 手机号码 -->
      <input id="mobilesignup" name="mobile" ng-model="user.mobile" type="tel" placeholder="请输入手机号" required/>
      <!-- 图形验证码 -->
      <input id="picCaptcha" name="picCaptcha" ng-model="user.picCaptcha" required="required" type="text" placeholder="请输入图形验证码" class="captchacode"/>
      <span><img src="{{getPicCaptcha}}" id="checkCaptcha" class="pic-verify no-padding margin-t--13 margin-l-5" ng-click="refreshCode()" width="78" height="40"></span>
      <!-- 短信验证码 -->
      <input id="captchasignup" name="captchasignup" ng-model="user.captcha" required="required" type="text" placeholder="请输入短信验证码" class="captchacode"/>
      <span><button ng-click="sendMobileCaptcha(user);" ng-disabled="registerForm.mobile.$invalid || registerForm.password.$invalid" onclick="countDown(this,60,'out');">短信验证码</button></span>
      <!-- 登录密码 -->
      <input id="passwordsignup" name="password" ng-model="user.password" ng-minlength="6" ng-maxlength="16"  required="required" type="password" placeholder="请输入登录密码" class="input-pwd" />
      <i class="fa fa-eye pwd-eyes ft-9f" ng-if="!showEyes" ng-click="selectEyes()"></i>
      <i class="fa fa-eye-slash pwd-eyes ft-9f" ng-if="showEyes" ng-click="selectEyes()"></i>
      <!-- 邀请码 -->
      <p class="margin-b-0 margin-t-1 ft-blue8 text-align" ng-click="investCode =!investCode;">邀请码<i class="fa fa-angle-double-down" aria-hidden="true"></i></p>
      <input class="input-invitecode" name="invitationCode" type="text" placeholder="邀请人手机号码（选填）" style="border-radius:0;" ng-model="user.inviteCode" ng-show="investCode"/>
    </div>
    <!-- 完成注册按钮 -->
    <p class="signin margin-0 text-center">
      <button type="submit" class="margin-t-2 button button-primary column {{registerForm.$invalid ? 'button-disabled' : ''}}" ng-disabled="registerForm.$invalid" ng-click="signUp(user);" my-click-once>完成注册</button>
    </p>
    <p class="margin-0 pull-left ft-small ft-9f">
      <input type="checkbox" checked/>注册即表示您同意<a href="javascript:;" ng-click="toggle();" class="ft-blue8">注册服务协议</a>
    </p>
    <p class="change_link margin-0 pull-right ft-small">
      <a ui-sref="root.login" class="to_login ft-blue8"> 登录>></a>
    </p>
  </form>
  <!-- 错误提示 -->
  <div class="toast" ng-show="showErrorMsg">
    <p ng-show="mobileShow">{{msg}}</p>
    <p class="showcaptcha"></p>
    <p class="ft-white" ng-if="registerForm.picCaptcha.$dirty && registerForm.picCaptcha.$invalid">
      <small ng-if="registerForm.picCaptcha.$error.check">图形验证码错误</small>
    </p>
  </div>
</div>
<div class="alert-agreement" ng-show="showRegistrationAgreement" ng-include src="'views/_registration-agreement.html'">
</div>
<div class="mask" ng-show="showRegistrationAgreement"></div>
<script>
function countDown(obj, second, inOrOut) {
  var getMobile = document.getElementById("mobilesignup");
  var mobilePattern = /^((13[0-9])|(15[^4,\D])|(18[0-9])|(17[03678])|(14[0-9]))\d{8}$/;

  if (inOrOut === 'out' && window.buttonFlag == 0) {
    return;
  }

  // 如果秒数还是大于0，则表示倒计时还没结束
  if (mobilePattern.test(getMobile.value)) {
    if (second >= 0) {
      // 获取默认按钮上的文字

      if (typeof buttonDefaultValue === 'undefined') {
        buttonDefaultValue = obj.defaultValue;
      }
      // 按钮置为不可点击状态
      obj.disabled = true;
      window.buttonFlag = 0;
      // 按钮里的内容呈现倒计时状态
      //obj.value = buttonDefaultValue + '(' + second + ')';
      obj.innerHTML = second + "s";
      obj.className = '';
      // 时间减一
      second--;
      // 一秒后重复执行
      setTimeout(function() {
        countDown(obj, second, 'in');
      }, 1000);
      // 否则，按钮重置为初始状态
    } else {
      // 按钮置为可点击状态
      obj.disabled = false;
      window.buttonFlag = 1;
      // 按钮里的内容恢复初始状态
      obj.className = '';
      obj.innerHTML = "重新发送";
    }
  } else {
    obj.disabled = true;
    window.buttonFlag = 0;
  }
}
</script>

